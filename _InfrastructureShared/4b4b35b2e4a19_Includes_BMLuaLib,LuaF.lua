-- Decompiled using luadec 2.2 rev: 895d923 for Lua 5.1 from https://github.com/viruscamp/luadec
-- Command line: /mnt/d/out/_InfrastructureShared/4b4b35b2e4a19_Includes_BMLuaLib,LuaF 

-- params : ...
-- function num : 0
local l_0_0 = IsProcNameInParentProcessTree
local l_0_1 = "BM"
local l_0_2 = {}
-- DECOMPILER ERROR at PC6: No list found for R2 , SetList fails

-- DECOMPILER ERROR at PC10: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC11: Overwrote pending register: R0 in 'AssignReg'

if l_0_0 then
  return l_0_0
end
-- DECOMPILER ERROR at PC13: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC15: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC16: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC19: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC20: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC21: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC22: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC23: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC26: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC27: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC28: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC29: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC30: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC33: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC34: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC35: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC36: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC37: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC40: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC41: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC42: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC43: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC44: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC47: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC48: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC49: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC50: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC51: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC54: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC55: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC56: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC57: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC58: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC61: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC62: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC63: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC64: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC65: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC68: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC69: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC70: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC71: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC72: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC75: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC76: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC77: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC78: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC79: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC82: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC83: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC84: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC85: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC86: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC89: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC90: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC91: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC92: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC93: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC96: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC97: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC98: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC99: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC100: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC103: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC104: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC105: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC106: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC107: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC110: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC111: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC112: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC113: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC114: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC117: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC118: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC119: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC120: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC121: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC124: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC125: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC126: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC127: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC128: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC131: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC132: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC133: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC134: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC135: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC138: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC139: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC140: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC141: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC142: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC145: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC146: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC147: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC148: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC149: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC152: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC153: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC154: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC155: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC156: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC159: Overwrote pending register: R0 in 'AssignReg'

-- DECOMPILER ERROR at PC160: Overwrote pending register: R1 in 'AssignReg'

-- DECOMPILER ERROR at PC161: Overwrote pending register: R2 in 'AssignReg'

-- DECOMPILER ERROR at PC162: Overwrote pending register: R3 in 'AssignReg'

if (((((((((((((((((((l_0_2 and not l_0_2) or l_0_2) and not l_0_2) or l_0_2) and not l_0_2) or l_0_2) and not l_0_2) or l_0_2) and not l_0_2) or l_0_2) and not l_0_2) or l_0_2) and not l_0_2) or l_0_2) and not l_0_2) or l_0_2) and not l_0_2) or l_0_2) and not l_0_2) or l_0_2 then
  local l_0_3 = "senseir.exe"
  -- DECOMPILER ERROR at PC163: Overwrote pending register: R4 in 'AssignReg'

  local l_0_4 = "pangphip.exe"
  -- DECOMPILER ERROR at PC164: Overwrote pending register: R5 in 'AssignReg'

  local l_0_5 = "agentexecutor.exe"
  local l_0_6 = 100
  local l_0_7 = "|"
  local l_0_8 = nil
  for l_0_12 = 1, mp.SIGATTR_LOG_SZ do
    if (sigattr_tail[l_0_12]).matched and (sigattr_tail[l_0_12]).attribute == 16400 then
      l_0_8 = sigattr_tail[l_0_12]
    end
  end
  local l_0_13 = (bm.get_current_process_startup_info)()
  local l_0_14 = reportSessionInformation()
  local l_0_15 = l_0_13.ppid .. l_0_7 .. l_0_8.ppid .. l_0_7 .. l_0_8.utf8p1 .. l_0_7 .. l_0_0 .. l_0_7 .. l_0_8.utf8p2
  AppendToRollingQueue(l_0_4, l_0_15, l_0_1, l_0_5, l_0_6, 0)
  local l_0_16 = l_0_4 .. "-" .. (l_0_14.User).UserName .. "[::]" .. tostring((l_0_14.Session).Id)
  AppendToRollingQueue(l_0_16, l_0_15, l_0_1, l_0_5, l_0_6, 0)
  local l_0_17 = GetRollingQueueSumOfValues(l_0_16)
  if l_0_17 and l_0_3 <= l_0_17.sum then
    sms_untrusted_process()
    reportSessionInformation()
    reportTimingData()
    ;
    (bm.add_related_file)(l_0_8.image_path)
    local l_0_18 = GetRollingQueue(l_0_4)
    for l_0_22,l_0_23 in ipairs(l_0_18) do
      local l_0_24 = explode(l_0_23.key, l_0_7)
      local l_0_25 = {}
      l_0_25.parentPPID = l_0_24[1]
      l_0_25.processPPID = l_0_24[2]
      l_0_25.process_image = l_0_24[3]
      l_0_25.process_cmd = l_0_24[4]
      l_0_23.key = l_0_25
      l_0_25 = bm
      l_0_25 = l_0_25.add_related_process
      l_0_25(l_0_24[1])
      l_0_25 = bm
      l_0_25 = l_0_25.add_related_process
      l_0_25(l_0_24[2])
    end
    local l_0_26 = bm.add_related_string
    local l_0_27 = "MassRecon"
    local l_0_28 = json_encode
    local l_0_29 = {}
    l_0_29.score = l_0_17
    l_0_29.events = l_0_18
    l_0_28 = l_0_28(l_0_29)
    l_0_29 = bm
    l_0_29 = l_0_29.RelatedStringBMReport
    l_0_26(l_0_27, l_0_28, l_0_29)
    l_0_26 = mp
    l_0_26 = l_0_26.INFECTED
    return l_0_26
  end
  do
    l_0_17 = GetRollingQueueSumOfValues(l_0_4)
    if l_0_17 and l_0_2 <= l_0_17.sum then
      sms_untrusted_process()
      reportSessionInformation()
      reportTimingData()
      ;
      (bm.add_related_file)(l_0_8.image_path)
      local l_0_30 = GetRollingQueue(l_0_4)
      for l_0_34,l_0_35 in ipairs(l_0_30) do
        local l_0_36 = explode(l_0_35.key, l_0_7)
        local l_0_37 = {}
        l_0_37.parentPPID = l_0_36[1]
        l_0_37.processPPID = l_0_36[2]
        l_0_37.process_image = l_0_36[3]
        l_0_37.process_cmd = l_0_36[4]
        l_0_35.key = l_0_37
        l_0_37 = bm
        l_0_37 = l_0_37.add_related_process
        l_0_37(l_0_36[1])
        l_0_37 = bm
        l_0_37 = l_0_37.add_related_process
        l_0_37(l_0_36[2])
      end
      local l_0_38 = bm.add_related_string
      local l_0_39 = "MassRecon"
      local l_0_40 = json_encode
      local l_0_41 = {}
      l_0_41.score = l_0_17
      l_0_41.events = l_0_30
      l_0_40 = l_0_40(l_0_41)
      l_0_41 = bm
      l_0_41 = l_0_41.RelatedStringBMReport
      l_0_38(l_0_39, l_0_40, l_0_41)
      l_0_38 = mp
      l_0_38 = l_0_38.INFECTED
      return l_0_38
    end
    do
      return mp.CLEAN
    end
  end
end

